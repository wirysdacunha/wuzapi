<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="WuzAPI - Gerenciador completo de instâncias WhatsApp">
    <meta name="theme-color" content="#075e54">
    <link rel="icon" href="/images/favicon.png" type="image/png">
    <title>WuzAPI Manager - Gerenciador de Instâncias WhatsApp</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/mobile.css">
</head>
<body>
    <!-- Barra de navegação -->
    <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="bi bi-whatsapp"></i>WuzAPI Manager
                <span id="adminBadge" class="badge bg-warning ms-2 d-none">Admin</span>
            </a>
            <!-- Status e controles só aparecem após login -->
            <div class="d-flex align-items-center auth-required" style="display: none !important;">
                <span class="text-white me-3 d-none d-md-flex" id="connectionStatus">
                    <div class="status-indicator status-disconnected" id="statusIndicator"></div>
                    <span id="statusText">Desconectado</span>
                </span>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
            </div>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto auth-required" style="display: none !important;">
                    <li class="nav-item d-block d-md-none">
                        <a class="nav-link" href="#" id="mobileStatus">
                            <i class="bi bi-circle-fill me-2 text-danger"></i>Status: <span id="statusTextMobile">Desconectado</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" id="refreshStatus">
                            <i class="bi bi-arrow-clockwise"></i>Atualizar Status
                        </a>
                    </li>
                    <li class="nav-item admin-only">
                        <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#manageInstancesModal">
                            <i class="bi bi-phone"></i>Gerenciar Instâncias
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/api" target="_blank">
                            <i class="bi bi-code-square"></i>Documentação API
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/" target="_blank">
                            <i class="bi bi-house-door"></i>Página Inicial
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" id="userNameDisplay">
                            <i class="bi bi-person-circle me-1"></i>Usuário
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" id="logoutBtn">
                            <i class="bi bi-box-arrow-right"></i>Sair
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Container Principal -->
    <div class="container-fluid py-4" id="mainContainer" style="display: none;">
        <div class="row">
            <!-- Sidebar das Instâncias (visível em telas grandes) -->
            <div class="col-md-3 col-lg-2 d-none d-md-block mb-4 admin-only">
                <div class="card">
                    <div class="card-header">
                        <i class="bi bi-phone-vibrate"></i>Instâncias
                    </div>
                    <div class="card-body p-2">
                        <div class="instance-selector" id="instanceList">
                            <!-- Lista de instâncias será carregada dinamicamente aqui -->
                            <div class="text-center py-4 text-muted" id="noInstancesMessage" style="display: none;">
                                <i class="bi bi-emoji-frown mb-2" style="font-size: 2rem;"></i>
                                <p>Nenhuma instância encontrada</p>
                                <button class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#addInstanceModal">
                                    <i class="bi bi-plus-circle"></i>Adicionar Instância
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="card-footer p-2 text-center">
                        <button class="btn btn-sm btn-primary w-100" data-bs-toggle="modal" data-bs-target="#addInstanceModal">
                            <i class="bi bi-plus-circle"></i>Nova Instância
                        </button>
                    </div>
                </div>

                <!-- Painel de informações do sistema (apenas admin) -->
                <div class="card mt-3 admin-only">
                    <div class="card-header">
                        <i class="bi bi-speedometer2"></i>Sistema
                    </div>
                    <div class="card-body p-2">
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span>Instâncias</span>
                                <span class="badge bg-primary rounded-pill" id="totalInstancesCount">-</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span>Conectadas</span>
                                <span class="badge bg-success rounded-pill" id="connectedInstancesCount">-</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center">
                                <span>Desconectadas</span>
                                <span class="badge bg-danger rounded-pill" id="disconnectedInstancesCount">-</span>
                            </li>
                        </ul>
                    </div>
                    <div class="card-footer p-2 text-center">
                        <button class="btn btn-sm btn-outline-primary w-100" id="refreshSystemStatusBtn">
                            <i class="bi bi-arrow-clockwise"></i>Atualizar
                        </button>
                    </div>
                </div>
            </div>

            <!-- Conteúdo Principal -->
            <div class="col-md-9 col-lg-10">
                <!-- Barra de ferramentas rápidas -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-body p-3">
                                <div class="d-flex flex-wrap gap-2">
                                    <button class="btn btn-sm btn-success me-2 action-btn" id="quickConnectBtn" data-condition="disconnected">
                                        <i class="bi bi-power"></i>Conectar
                                    </button>
                                    <button class="btn btn-sm btn-warning me-2 action-btn" id="quickDisconnectBtn" data-condition="connected">
                                        <i class="bi bi-pause-circle"></i>Desconectar
                                    </button>
                                    <button class="btn btn-sm btn-outline-primary me-2 action-btn" id="quickQrBtn" data-condition="waiting-qr">
                                        <i class="bi bi-qr-code"></i>QR Code
                                    </button>
                                    <div class="ms-auto d-md-none">
                                        <button class="btn btn-sm btn-outline-secondary admin-only" data-bs-toggle="modal" data-bs-target="#manageInstancesModal">
                                            <i class="bi bi-phone"></i>Instâncias
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Painel de administração (sempre visível para admin) -->
                <div class="row mb-4 admin-only" id="adminDashboardPanel">
                    <div class="col-12">
                        <div class="card card-admin">
                            <div class="card-header">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div><i class="bi bi-shield-lock me-2"></i>Painel Administrativo</div>
                                    <button class="btn btn-sm btn-outline-light" id="refreshAdminStats">
                                        <i class="bi bi-arrow-clockwise"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-4 mb-3">
                                        <div class="card bg-light h-100">
                                            <div class="card-body">
                                                <h5 class="card-title">Instâncias</h5>
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <div id="totalInstancesCount" class="display-4">0</div>
                                                    <i class="bi bi-phone text-primary fs-1"></i>
                                                </div>
                                                <div class="mt-2">
                                                    <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#addInstanceModal">
                                                        <i class="bi bi-plus-circle"></i> Nova Instância
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <div class="card bg-light h-100">
                                            <div class="card-body">
                                                <h5 class="card-title">Conectadas</h5>
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <div id="connectedInstancesCount" class="display-4">0</div>
                                                    <i class="bi bi-check-circle text-success fs-1"></i>
                                                </div>
                                                <div class="mt-2">
                                                    <button class="btn btn-sm btn-outline-success" id="checkSystemStatusBtn">
                                                        <i class="bi bi-check-circle"></i> Verificar Sistema
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        <div class="card bg-light h-100">
                                            <div class="card-body">
                                                <h5 class="card-title">Desconectadas</h5>
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <div id="disconnectedInstancesCount" class="display-4">0</div>
                                                    <i class="bi bi-x-circle text-danger fs-1"></i>
                                                </div>
                                                <div class="mt-2">
                                                    <button class="btn btn-sm btn-outline-danger" id="refreshInstancesBtn">
                                                        <i class="bi bi-arrow-repeat"></i> Atualizar Status
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Lista de instâncias (apenas para admin) -->
                <div class="row mb-4 admin-only" id="adminInstancesListPanel">
                    <div class="col-12">
                        <div class="card">
                            <div class="card-header">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div><i class="bi bi-phone me-2"></i>Instâncias Disponíveis</div>
                                    <button class="btn btn-sm btn-outline-light" id="refreshInstancesListBtn">
                                        <i class="bi bi-arrow-clockwise"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-striped table-hover mb-0">
                                        <thead>
                                            <tr>
                                                <th>ID</th>
                                                <th>Nome</th>
                                                <th>Número</th>
                                                <th>Status</th>
                                                <th>Ações</th>
                                            </tr>
                                        </thead>
                                        <tbody id="adminInstancesList">
                                            <!-- Instâncias serão carregadas aqui -->
                                            <tr>
                                                <td colspan="5" class="text-center">Carregando instâncias...</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="card-footer">
                                <div class="d-flex justify-content-between">
                                    <span class="text-muted">Total: <span id="instancesCount">0</span> instâncias</span>
                                    <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#addInstanceModal">
                                        <i class="bi bi-plus-circle me-1"></i>Nova Instância
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Dashboard de instância (visível para todos) -->
                <div class="row" id="instanceDashboard">
                    <ul class="nav nav-tabs" id="dashboardTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="status-tab" data-bs-toggle="tab" data-bs-target="#statusTab" type="button" role="tab" aria-controls="statusTab" aria-selected="true">
                                <i class="bi bi-info-circle"></i> Status
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="webhook-tab" data-bs-toggle="tab" data-bs-target="#webhookTab" type="button" role="tab" aria-controls="webhookTab" aria-selected="false">
                                <i class="bi bi-link-45deg"></i> Webhook
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="messages-tab" data-bs-toggle="tab" data-bs-target="#messagesTab" type="button" role="tab" aria-controls="messagesTab" aria-selected="false">
                                <i class="bi bi-chat-text"></i> Mensagens
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="groups-tab" data-bs-toggle="tab" data-bs-target="#groupsTab" type="button" role="tab" aria-controls="groupsTab" aria-selected="false">
                                <i class="bi bi-people"></i> Grupos
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="settings-tab" data-bs-toggle="tab" data-bs-target="#settingsTab" type="button" role="tab" aria-controls="settingsTab" aria-selected="false">
                                <i class="bi bi-gear"></i> Configurações
                            </button>
                        </li>
                    </ul>
                    <div class="tab-content" id="dashboardContent">
                        <div class="tab-pane fade show active" id="statusTab" role="tabpanel" aria-labelledby="status-tab">
                            <!-- Conteúdo do dashboard de instância -->
                        </div>
                        <div class="tab-pane fade" id="webhookTab" role="tabpanel" aria-labelledby="webhook-tab">
                            <!-- Conteúdo do dashboard de instância -->
                        </div>
                        <div class="tab-pane fade" id="messagesTab" role="tabpanel" aria-labelledby="messages-tab">
                            <!-- Conteúdo do dashboard de instância -->
                        </div>
                        <div class="tab-pane fade" id="groupsTab" role="tabpanel" aria-labelledby="groups-tab">
                            <!-- Conteúdo do dashboard de instância -->
                        </div>
                        <div class="tab-pane fade" id="settingsTab" role="tabpanel" aria-labelledby="settings-tab">
                            <!-- Conteúdo do dashboard de instância -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tela de Login -->
    <div id="loginScreen">
        <div class="container">
            <div class="card">
                <div class="card-body">
                    <div class="text-center mb-4">
                        <i class="bi bi-whatsapp"></i>
                        <h2>WuzAPI Manager</h2>
                        <p class="text-muted">Faça login para acessar o dashboard</p>
                    </div>
                    
                    <form id="loginForm" class="mb-4">
                        <div class="mb-3">
                            <label for="loginToken" class="form-label">Token de Acesso</label>
                            <input type="text" class="form-control" id="loginToken" 
                                placeholder="Digite seu token de acesso">
                            <div class="form-text">
                                Token usado para autenticar suas requisições à API.
                            </div>
                        </div>
                        
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-box-arrow-in-right me-2"></i>Entrar
                            </button>
                            <button type="button" class="btn btn-outline-secondary" id="loginAsAdminBtn">
                                <i class="bi bi-shield-lock me-2"></i>Login como Admin
                            </button>
                        </div>
                    </form>
                    
                    <div class="alert alert-info">
                        <div class="d-flex align-items-center mb-2">
                            <i class="bi bi-info-circle fs-4 me-2"></i>
                            <strong>Dicas de Acesso</strong>
                        </div>
                        <p class="mb-2">Você pode acessar de três formas:</p>
                        <ol class="mb-0">
                            <li>Digite seu token no campo acima</li>
                            <li>Use o parâmetro <code>?token=seu-token</code> na URL</li>
                            <li>Faça login como administrador</li>
                        </ol>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container-fluid">
            <div class="row mb-3">
                <div class="col-md-12 text-center">
                    <h4 class="mb-3 fw-bold">
                        <i class="bi bi-whatsapp me-2"></i>WuzAPI - Gerenciador de Instâncias WhatsApp
                    </h4>
                    <p class="text-muted">Gerenciamento simplificado para múltiplas instâncias de WhatsApp</p>
                </div>
            </div>
            <div class="row">
                <div class="col-md-12 text-center">
                    <ul class="list-inline mb-2">
                        <li class="list-inline-item me-4">
                            <a href="/" class="text-decoration-none text-white">
                                <i class="bi bi-house-door me-1"></i>Página Inicial
                            </a>
                        </li>
                        <li class="list-inline-item me-4">
                            <a href="/api" class="text-decoration-none text-white">
                                <i class="bi bi-code-square me-1"></i>Documentação API
                            </a>
                        </li>
                        <li class="list-inline-item">
                            <a href="/login" class="text-decoration-none text-white">
                                <i class="bi bi-box-arrow-in-right me-1"></i>Login Simples
                            </a>
                        </li>
                    </ul>
                    <div class="mt-3 version-info">
                        <span class="badge bg-dark me-2">Versão 1.1.0</span>
                        <a href="https://github.com/guilhermejansen/wuzapi" target="_blank" class="text-decoration-none text-white">
                            <i class="bi bi-github me-1"></i>GitHub
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Modal para configuração de token -->
    <div class="modal fade" id="tokenModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content glass-card">
                <div class="modal-header border-0">
                    <h5 class="modal-title"><i class="bi bi-key me-2"></i>Configurar Token</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-4">
                        <label for="tokenInput" class="form-label fw-bold">Token de Autenticação</label>
                        <input type="text" class="form-control form-control-lg" id="tokenInput" placeholder="Digite seu token">
                        <div class="form-text">Token usado para autenticar suas requisições à API.</div>
                    </div>
                    <div class="alert alert-info border-0 glass-card">
                        <div class="d-flex align-items-center mb-2">
                            <i class="bi bi-shield-lock fs-4 me-2 text-primary"></i>
                            <strong>Acesso de Administrador</strong>
                        </div>
                        <p class="mb-1">Para acessar como administrador, use o token definido na variável de ambiente <code>WUZAPI_ADMIN_TOKEN</code>.</p>
                        <p class="mb-0">O usuário administrador pode gerenciar todas as instâncias do sistema.</p>
                    </div>
                </div>
                <div class="modal-footer border-0">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="saveTokenBtn">
                        <i class="bi bi-check-lg me-1"></i>Salvar
                    </button>
                    <button type="button" class="btn btn-warning" id="loginAsAdminBtn">
                        <i class="bi bi-shield-lock me-1"></i>Login Admin
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para adicionar nova instância -->
    <div class="modal fade" id="addInstanceModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Adicionar Nova Instância</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="newInstanceName" class="form-label">Nome da Instância*</label>
                            <input type="text" class="form-control" id="newInstanceName" placeholder="Ex: Atendimento, Marketing, etc" required>
                            <div class="form-text">Um nome para identificar facilmente sua instância.</div>
                        </div>
                        <div class="col-md-6">
                            <label for="newInstanceToken" class="form-label">Token</label>
                            <div class="input-group">
                                <input type="text" class="form-control" id="newInstanceToken" placeholder="Deixe em branco para gerar automaticamente">
                                <button class="btn btn-outline-secondary" type="button" id="generateTokenBtn">
                                    <i class="bi bi-key"></i> Gerar
                                </button>
                            </div>
                            <div class="form-text">Token da instância ou deixe em branco para gerar automaticamente.</div>
                        </div>
                    </div>
                    
                    <div class="accordion" id="instanceConfigAccordion">
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="webhookHeading">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#webhookConfig" aria-expanded="false" aria-controls="webhookConfig">
                                    Configuração de Webhook (Opcional)
                                </button>
                            </h2>
                            <div id="webhookConfig" class="accordion-collapse collapse" aria-labelledby="webhookHeading" data-bs-parent="#instanceConfigAccordion">
                                <div class="accordion-body">
                                    <div class="mb-3">
                                        <label for="newInstanceWebhook" class="form-label">URL do Webhook</label>
                                        <input type="url" class="form-control" id="newInstanceWebhook" placeholder="https://seu-servidor.com/webhook">
                                        <div class="form-text">URL para receber notificações de eventos do WhatsApp.</div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">Eventos</label>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="form-check mb-2">
                                                    <input class="form-check-input new-instance-event" type="checkbox" value="Message" id="newEventMessage" checked>
                                                    <label class="form-check-label" for="newEventMessage">
                                                        Mensagens
                                                    </label>
                                                </div>
                                                <div class="form-check mb-2">
                                                    <input class="form-check-input new-instance-event" type="checkbox" value="ReadReceipt" id="newEventReadReceipt">
                                                    <label class="form-check-label" for="newEventReadReceipt">
                                                        Confirmações de Leitura
                                                    </label>
                                                </div>
                                                <div class="form-check mb-2">
                                                    <input class="form-check-input new-instance-event" type="checkbox" value="HistorySync" id="newEventHistorySync">
                                                    <label class="form-check-label" for="newEventHistorySync">
                                                        Sincronização de Histórico
                                                    </label>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="form-check mb-2">
                                                    <input class="form-check-input new-instance-event" type="checkbox" value="Presence" id="newEventPresence">
                                                    <label class="form-check-label" for="newEventPresence">
                                                        Presença
                                                    </label>
                                                </div>
                                                <div class="form-check mb-2">
                                                    <input class="form-check-input new-instance-event" type="checkbox" value="ChatPresence" id="newEventChatPresence">
                                                    <label class="form-check-label" for="newEventChatPresence">
                                                        Presença em Chat
                                                    </label>
                                                </div>
                                                <div class="form-check mb-2">
                                                    <input class="form-check-input" type="checkbox" value="All" id="newEventAll">
                                                    <label class="form-check-label" for="newEventAll">
                                                        Todos os Eventos
                                                    </label>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3 form-check">
                                        <input type="checkbox" class="form-check-input" id="newWebhookActiveCheck" checked>
                                        <label class="form-check-label" for="newWebhookActiveCheck">Webhook Ativo</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="proxyHeading">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#proxyConfig" aria-expanded="false" aria-controls="proxyConfig">
                                    Configuração de Proxy (Opcional)
                                </button>
                            </h2>
                            <div id="proxyConfig" class="accordion-collapse collapse" aria-labelledby="proxyHeading" data-bs-parent="#instanceConfigAccordion">
                                <div class="accordion-body">
                                    <div class="mb-3">
                                        <label for="newInstanceProxy" class="form-label">URL do Proxy</label>
                                        <input type="text" class="form-control" id="newInstanceProxy" placeholder="socks5://user:pass@host:port ou http://host:port">
                                        <div class="form-text">URL do proxy para conexão com o WhatsApp.</div>
                                    </div>
                                    <div class="mb-3 form-check">
                                        <input type="checkbox" class="form-check-input" id="newEnableProxyCheck">
                                        <label class="form-check-label" for="newEnableProxyCheck">Habilitar Proxy</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" id="createInstanceBtn">
                        <i class="bi bi-plus-circle"></i>Criar Instância
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal para gerenciar instâncias -->
    <div class="modal fade" id="manageInstancesModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Gerenciar Instâncias</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col-12 text-end">
                            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addInstanceModal">
                                <i class="bi bi-plus-circle"></i>Nova Instância
                            </button>
                        </div>
                    </div>
                    
                    <div id="mobileNoInstancesMessage" class="text-center py-4 text-muted">
                        <i class="bi bi-emoji-frown mb-2" style="font-size: 2rem;"></i>
                        <p>Nenhuma instância encontrada</p>
                        <button class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#addInstanceModal">
                            <i class="bi bi-plus-circle"></i>Adicionar Instância
                        </button>
                    </div>
                    
                    <div class="list-group" id="mobileInstanceList">
                        <!-- Lista de instâncias será carregada dinamicamente aqui -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal de confirmação para excluir instância -->
    <div class="modal fade" id="confirmDeleteInstanceModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Confirmar Exclusão</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Tem certeza que deseja remover esta instância? Esta ação não pode ser desfeita.</p>
                    <p class="text-danger"><strong>Atenção:</strong> Todos os dados associados à instância serão perdidos.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">
                        <i class="bi bi-trash"></i>Sim, Remover Instância
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de carregamento -->
    <div class="modal fade" id="loadingModal" tabindex="-1" data-bs-backdrop="static" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body text-center p-4">
                    <div class="spinner-border text-primary mb-3" style="width: 3rem; height: 3rem;" role="status"></div>
                    <h5 id="loadingMessage">Processando sua solicitação...</h5>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Scripts modularizados -->
    <script src="js/utils.js"></script>
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/instances.js"></script>
    <script src="js/messages.js"></script>
    <script src="js/webhooks.js"></script>
    <script src="js/groups.js"></script>
    <script src="js/admin.js"></script>
    <script src="js/app.js"></script>
    <script>
        // Verificação única de carregamento da página
        if (!window.dashboardInitCheck) {
            console.log("[DASHBOARD] Primeira inicialização do dashboard");
            window.dashboardInitCheck = true;
            
            // A inicialização principal é feita no app.js e auth.js
            // Este script apenas garante que não haja inicializações duplicadas
        }
    </script>
</body>
</html> 